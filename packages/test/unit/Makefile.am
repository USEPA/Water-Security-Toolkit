include ${top_srcdir}/config/MakeMacros.mk
SUFFIXES=.i

CXXTEST= ${top_builddir}/tpl/acro/python/bin/cxxtestgen

LIBDIR=@top_builddir@/lib
BINDIR=@top_builddir@/bin
INCDIR=@top_builddir@/include
LIBBUILD=@top_builddir@/packages
SRCPACKAGES=@top_srcdir@/packages

ACRO=@top_builddir@/tpl/@acro@
UTILIBDIR=$(ACRO)/packages/utilib/src


TOPINC=$(top_builddir)
TOPLIB=$(top_builddir)/lib
TOPBUILDBIN=${top_builddir}/bin

TOPSRCBIN=${top_srcdir}/bin

LDADD=$(LIBBUILD)/cat/tso2Impact/libsp.la $(LIBBUILD)/detect/libdetect.la $(ACRO)/lib/libutilib.la $(TINYXML_LIB)

AM_CPPFLAGS=-I$(INCDIR) -I$(INCDIR)/tevalibs -I$(SRCPACKAGES)/detect -I$(ACRO)/include -I$(ACRO)/tpl/cxxtest

#
# programs to build at "make check" time
#
check_PROGRAMS = runner


if BUILD_SHARED
  EXECS=$(check_PROGRAMS:%=.libs/%)
else
  EXECS=$(check_PROGRAMS)
endif

BIN_COPIES=$(check_PROGRAMS:%=$(TOPBIN)/%)

# sources autogenerated by cxxtest (and will be removed during 'make clean'
runner_CXXTEST_SRC=\
	TDummy.cpp\
	runner.cpp

runner_STATIC_SRC=

runner_SOURCES=$(runner_STATIC_SRC) $(runner_CXXTEST_SRC)

runner.cpp:
	$(CXXTEST) --root --xunit-printer -w spot-xunit -o runner.cpp

# Implicit rule to invoke cxxtest to autogenerate .cpp from .h test files
.h.cpp:
	$(CXXTEST) --part -o $@ $<

# prevent implicit rule for static sources
.PHONY:
$(runner_STATIC_SRC):
	@echo NO-OP


check-local:
	@echo ""

clean-local:
	rm -f *.gcda *.gcno *.gcov
	@for i in *.gcda *.gcno *.gcov ; \
        do\
                rm -f $$i ;\
        done

