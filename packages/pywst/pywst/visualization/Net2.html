<html><body bgcolor='#ffffff' style='overflow: hidden;'><svg id='svgNetView' style='position: absolute; left: 0px; top: 0px; width: 20000px; height: 20000px'><rect id='rectNetBg' x=-9989.0 y=-9996.0 width=20045.0 height=20083.0 fill='#999999'></rect><g id='gNetView' transform='rotate(180) scale(-6.02409638554,6.02409638554) translate(-6.5,-95.3)'><path id='Pipes' class='Link Pipe' d='M 0 0  M 21.0 4.0 L 19.0 20.0 M 19.0 20.0 L 19.0 25.0 M 19.0 20.0 L 11.0 21.0 M 11.0 21.0 L 14.0 28.0 M 14.0 28.0 L 19.0 25.0 M 19.0 25.0 L 28.0 23.0 M 28.0 23.0 L 36.0 39.0 M 36.0 39.0 L 38.0 30.0 M 36.0 39.0 L 36.0 42.0 M 38.0 30.0 L 37.0 23.0 M 36.0 42.0 L 37.0 49.0 M 37.0 49.0 L 39.0 60.0 M 39.0 60.0 L 38.0 64.0 M 38.0 64.0 L 38.0 66.0 M 38.0 66.0 L 37.0 69.0 M 38.0 64.0 L 27.0 65.0 M 37.0 69.0 L 27.0 69.0 M 27.0 65.0 L 27.0 69.0 M 27.0 69.0 L 23.0 68.0 M 23.0 68.0 L 23.0 64.0 M 27.0 65.0 L 21.0 59.0 M 38.0 66.0 L 45.0 68.0 M 45.0 68.0 L 51.0 62.0 M 51.0 62.0 L 54.0 69.0 M 45.0 68.0 L 54.0 69.0 M 37.0 71.0 L 35.0 74.0 M 37.0 69.0 L 37.0 71.0 M 35.0 74.0 L 35.0 76.0 M 35.0 76.0 L 33.0 76.0 M 35.0 76.0 L 37.0 80.0 M 37.0 80.0 L 39.0 87.0 M 39.0 87.0 L 42.0 86.0 M 42.0 86.0 L 49.0 85.0 M 54.0 69.0 L 56.0 73.0 M 56.0 73.0 L 56.0 77.0 M 23.0 64.0 L 21.0 59.0 M 42.0 86.0 L 43.0 81.0 M 43.0 81.0 L 47.0 80.0 M 49.0 85.0 L 43.0 81.0 M 49.0 85.0 L 53.0 87.0' stroke-width=0.166 stroke='#000000' stroke-opacity=0.6 stroke-linecap='round' fill='none'></path><circle class='Node Junction' id='Node_24' data-id='24' data-type='Junction' transform='translate(37.0,71.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_25' data-id='25' data-type='Junction' transform='translate(35.0,76.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_27' data-id='27' data-type='Junction' transform='translate(39.0,87.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_20' data-id='20' data-type='Junction' transform='translate(45.0,68.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_21' data-id='21' data-type='Junction' transform='translate(51.0,62.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_22' data-id='22' data-type='Junction' transform='translate(54.0,69.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_23' data-id='23' data-type='Junction' transform='translate(35.0,74.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_28' data-id='28' data-type='Junction' transform='translate(49.0,85.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_29' data-id='29' data-type='Junction' transform='translate(42.0,86.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_1' data-id='1' data-type='Junction' transform='translate(21.0,4.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_3' data-id='3' data-type='Junction' transform='translate(11.0,21.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_2' data-id='2' data-type='Junction' transform='translate(19.0,20.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_5' data-id='5' data-type='Junction' transform='translate(19.0,25.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_4' data-id='4' data-type='Junction' transform='translate(14.0,28.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_7' data-id='7' data-type='Junction' transform='translate(36.0,39.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_6' data-id='6' data-type='Junction' transform='translate(28.0,23.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_9' data-id='9' data-type='Junction' transform='translate(36.0,42.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_8' data-id='8' data-type='Junction' transform='translate(38.0,30.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_11' data-id='11' data-type='Junction' transform='translate(37.0,49.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_10' data-id='10' data-type='Junction' transform='translate(37.0,23.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_13' data-id='13' data-type='Junction' transform='translate(38.0,64.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_12' data-id='12' data-type='Junction' transform='translate(39.0,60.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_15' data-id='15' data-type='Junction' transform='translate(37.0,69.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_14' data-id='14' data-type='Junction' transform='translate(38.0,66.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_17' data-id='17' data-type='Junction' transform='translate(27.0,69.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_16' data-id='16' data-type='Junction' transform='translate(27.0,65.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_19' data-id='19' data-type='Junction' transform='translate(21.0,59.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_18' data-id='18' data-type='Junction' transform='translate(23.0,68.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_31' data-id='31' data-type='Junction' transform='translate(37.0,80.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_30' data-id='30' data-type='Junction' transform='translate(47.0,80.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_36' data-id='36' data-type='Junction' transform='translate(53.0,87.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_35' data-id='35' data-type='Junction' transform='translate(43.0,81.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_34' data-id='34' data-type='Junction' transform='translate(56.0,77.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_33' data-id='33' data-type='Junction' transform='translate(56.0,73.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><circle class='Node Junction' id='Node_32' data-id='32' data-type='Junction' transform='translate(23.0,64.0)' r=0.83 fill='#000000' fill-opacity=0.6></circle><path class='Node Tank' id='Node_26' data-id='26' data-type='Tank' d=' M 32.419 75.17 l 0.0 1.66 l 0.083 0.0 l 0.166 -0.166 l 0.166 0.166 l 0.166 -0.166 l 0.166 0.166 l 0.166 -0.166 l 0.166 0.166 l 0.083 0.0 l 0.0 -1.66 a 0.83 0.83 0 0 0 -1.162 0.0' stroke='none' fill='#000099' fill-opacity=0.6></path></g><text id='m_Popup' x=0 y=0 style='font-size:12px; font-family:Tahoma,Consolas,Lucida Console,Verdana,sans-serif'>TESTING123</text></svg></body></html><script id= 'script1' type='text/javascript'>
	
	var glSvgRoot = document.getElementById('svgNetView');
	var glRoot = document.getElementById('gNetView');
	var glEventState = '';
	var glEventStateTf = null;
	var glEventStateOrigin = null;
	
	window.onload = function(e) {
		document.getElementById('svgNetView').ondragstart = function() { return false; };
		var elements = document.getElementsByTagName('text');
		var max = 0;
		for (var index in elements) {
			var element = elements[index];
			var legend = GetData(element, 'legend');
			if (legend) {
				var box = element.getBBox();
				max = Math.max(max, box.width);
			}
		}
		var element = document.getElementById('rectLegend');
		if (element) {
			element.setAttribute('width', max + 30 + 7);
		}
	}
	
	function SetCTM(element, m) {
		var s = 'matrix('+m.a+','+m.b+','+m.c+','+m.d+','+m.e+','+m.f+')';
		element.setAttribute('transform', s);
	}
	
	function GetEventPoint(e) {
		var p = glSvgRoot.createSVGPoint();
		var offset = glSvgRoot.getBoundingClientRect();
		p.x = e.clientX;
		p.y = e.clientY;
		return p;
	}
	
	function OnMouseWheel(e) {
		var e = window.event || e;
		if (e && e.target) {
			var target = e.target;
		} else if (e && e.srcElement) {
			var target = e.srcElement;
		} else {
			var target = null;
		}
		if (target && target.id == '') return;
		if (target && target.id == 'rectLegend') return;
		var delta;
		if (e.wheelDelta) {
			delta = e.wheelDelta / 3600;
		} else {
			delta = e.detail / -90;
		}
		var z = 1 + delta;
		var m = glRoot.getCTM();
		m = m.inverse();
		p = GetEventPoint(e);
		p = p.matrixTransform(m);
		var m = glSvgRoot.createSVGMatrix();
		var m = m.translate(p.x, p.y);
		var m = m.scale(z);
		var m = m.translate(-p.x, -p.y);
		var ctm = glRoot.getCTM();
		var ctm = ctm.multiply(m);
		SetCTM(glRoot, ctm);
	}
	
	function OnMouseDown(e) {
		var e = window.event || e;
		if (e && e.target) {
			var target = e.target;
		} else if (e && e.srcElement) {
			var target = e.srcElement;
		} else {
			return;
		}
		if (target.id == '') return;
		if (target.id == 'rectLegend') {
			glEventState = 'pan_legend';
			var root = document.getElementById('gLegend');
			var m = root.getCTM();
		} else {
			glEventState = 'pan';
			var m = glRoot.getCTM();
		}
		glEventStateTf = m.inverse();
		var p = GetEventPoint(e);
        glEventStateOrigin = p.matrixTransform(glEventStateTf);
	}
	
	function OnMouseUp(e) {
		var e = window.event || e;
		glEventState = '';
	}
	
	function OnMouseMove(e) {
		var e = window.event || e;
		DoPopup(e);
		if (glEventState == 'pan' || glEventState == 'pan_legend') {
			var p = GetEventPoint(e);
			var p = p.matrixTransform(glEventStateTf);
			var x = p.x - glEventStateOrigin.x;
			var y = p.y - glEventStateOrigin.y;
			var m = glEventStateTf.inverse();
			var m = m.translate(x, y);
			if (glEventState == 'pan') {
				SetCTM(glRoot, m);
			} else {
				var root = document.getElementById('gLegend');
				SetCTM(root, m);
				
			}
		}
	}
	
	function OnMouseOver(e) {
		var e = window.event || e;
		var target = GetTarget(e);
		DoLayers(e);
	}
	
	function OnMouseOut(e) {
		var e = window.event || e;
		var target = GetTarget(e);
		if (target == null) return;
		var legend = GetData(target, 'legend');
		if (legend == null && target.id != 'rectLegend') {
			DoLayers2(-1);
		}
	}
	
	function DoLayers(e) {
		var target = GetTarget(e);
		var legend = GetData(target, 'legend');
		if (legend) {
			var layer = GetData(target, 'layer');
			var ilayer = parseInt(layer);
			DoLayers2(ilayer);
		}
	}
	
	function DoLayers2(ilayer) {
		var elements = document.getElementsByTagName('*');
		for (var index in elements) {
			var element = elements[index];
			var layer = GetData(element, 'layer');
			var legend = GetData(element, 'legend');
			if (layer && legend == null) {
				var i = parseInt(layer);
				if (i == ilayer || ilayer < 0) {
					element.setAttribute('display', 'inherit');
				} else {
					element.setAttribute('display', 'none');
				}
			}
		}
	}
	
	function DoPopup(e) {
		var popup = document.getElementById('m_Popup')
		if (e && e.target) {
			var target = e.target;
		} else if (e && e.srcElement) {
			var target = e.srcElement;
		} else {
			popup.textContent = '';
			return;
		}
		var id = GetData(target, 'id');
		if (target.id == 'm_Popup') {
			popup.setAttribute('visibility','hidden');
			var behind = document.elementFromPoint(e.clientX, e.clientY);
			popup.setAttribute('visibility','inherit');
			id = GetData(behind, 'id');
		}
		if (id) {
			popup.textContent = id;
		} else {
			popup.textContent = '';
		}
		popup.setAttribute('x', e.clientX + 4);
		popup.setAttribute('y', e.clientY - 4);
	}
	
	function GetTarget(e) {
		if (e && e.target    ) return e.target    ;
		if (e && e.srcElement) return e.srcElement;
		return null;
	}
	
	function GetData(target, variable) {
		if (target    == null) return null;
		if (target.id == null) return null;
		if (target.dataset) return target.dataset[variable];
		return target.getAttribute('data-' + variable);
	}
	
	function addListeners() {
		var elements = document.getElementsByTagName('*');
		for (var index in elements) {
			var element = elements[index];
			if (element.addEventListener) {
				element.addEventListener('mousewheel'    , OnMouseWheel, false);
				element.addEventListener('DOMMouseScroll', OnMouseWheel, false);
				element.addEventListener('mousedown'     , OnMouseDown , false);
				element.addEventListener('mouseup'       , OnMouseUp   , false);
				element.addEventListener('mousemove'     , OnMouseMove , false);
				element.addEventListener('mouseover'     , OnMouseOver , false);
				element.addEventListener('mouseover'     , OnMouseOut  , false);
			} else if (element.attachEvent) {
				element.attachEvent('onmousewheel', OnMouseWheel);
				element.attachEvent('mousedown'   , OnMouseDown );
				element.attachEvent('mouseup'     , OnMouseUp   );
				element.attachEvent('mousemove'   , OnMouseMove );
				element.attachEvent('mouseover'   , OnMouseOver );
				element.attachEvent('mouseover'   , OnMouseOut  );
			}
		}
	}
	
	addListeners();
</script>
